<!DOCTYPE html>
<html>
<head>
<style type="text/css">
#states path {
  fill: none;
  stroke: #999;
  stroke-width: 1px;
}
#waypoints circle {
  
}
</style>
<script src="http://d3js.org/d3.v3.min.js"></script>
</head>
<body>
<script>
var projection = d3.geo.albers().scale(3500).translate([90, 440]);

var path = d3.geo.path()
    .projection(projection);

var OPPoint = function(opEntry) {
  return "translate(" + projection([opEntry.lon, opEntry.lat]).join(',') + ")";
};

var svg = d3.select("body").append("svg:svg")
    .attr("class", "Blues")
    .attr("width", 1280)
    .attr("height", 800);

var states = svg.append("svg:g")
    .attr("id", "states");

var waypoints = svg.append("svg:g")
    .attr("id", "waypoints");

d3.json("us-states.json", function(json) {
  states.selectAll("path")
      .data(json.features)
    .enter().append("svg:path")
      .attr("d", path);
});

d3.json("openpaths_davidstolarsky.json", function(op) {
  console.log(op.length + " OpenPaths waypoints");
  op = op.sort(function(a,b) {
    if(a.t < b.t)
      return -1;
    if(a.t > b.t)
      return 1;
    return 0;
  });
  
  var timeBounds = [op[0].t, op[op.length-1].t].map(function(t){
    var d = new Date();
    d.setTime(t*1000);
    return d.toUTCString();
  });
  console.log("First: " + timeBounds[0]);
  console.log("Last:  " + timeBounds[1]);
  
  waypoints.selectAll("circle")
      .data(op)
    .enter().append("svg:circle")
      .attr("cx", 0)
      .attr("cy", 0)
      .attr("r", 1.0)
      .attr("transform", OPPoint);
});

d3.select("select").on("change", function() {
  d3.selectAll("svg").attr("class", this.value);
});
</script>
</body>
</html>
